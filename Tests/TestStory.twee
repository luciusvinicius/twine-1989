:: StoryTitle
TestStory


:: StoryData
{
  "ifid": "237AA265-E94F-4DA1-8822-40A1112CA802",
  "format": "SugarCube",
  "format-version": "2.36.1",
  "start": "Start Point",
  "zoom": 1
}


:: MainLocationHUD {"position":"1100,100","size":"100,100"}
<<script>>advanceTimeStep();<</script>>

<<set $money to getMoney()>>
<<set $susmeter to getSusmeter()>>
<<set $day to getDay()>>
<<set $time to getTime()>>

Money: $money
Suspicion Level: $susmeter
Datetime: Day $day, $time

<<link "Wait for 1 hour">>
<<script>>advanceTimeStep(HOUR_DIVIDER - 1);<</script>>
<<set _day to getDay()>>
<<set _time to getTime()>>

<<set _this_passage to passage()>>
<<goto _this_passage>>
<</link>>

----
----


:: Start Point {"position":"200,125","size":"100,100"}
<<set $last_location to "Newspaper Stand">>

[[Start Game|Newspaper Stand]]


:: Newspaper Stand
<<set $last_location to "Newspaper Stand">>
<<include "MainLocationHUD">>
//My humble newspaper stand. Selling newspapers is not the most profitable or even successful career path, but it's all I have.//

[[Attend next customer|Simple Customer]]
[[Leave|Start Point]]


:: Simple Customer
//A new customer approaches. Time to put on my best smile.//

"Mornin'.
I want the Tribune Times."

<<set _choice to either("Entry Talk 1", "No talk")>>
[[Give newspaper|_choice]]
[[Refuse|Order Refused]]


:: Entry Talk 1
"Thanks. Hope your day is better than mine."

//Seems like they're in a chatty mood.//

[[Something troubling you?|Small Talk 1]]
[[Thanks. See you again.|$last_location]]


:: No talk
"Thanks. Bye."

[[Back|$last_location]]


:: Order Refused
"What the fuck?!"

//They left rather angry.//

//I guess that's to be expected.//

[[Back|$last_location]]


:: Small Talk 1
"O-Oh, uh, same as what's troubling everyone else, I'spose."

//They seem to have realised they were about to imply their life wasn't good.//

''It must be hard sometimes. Supporting your family, I mean.''

"I... suppose so."

//They look intrigued.//

<<link "Across the border, things don't seem to be so difficult, I hear." "Suggest help 1">>
  /* this choice attempts to start the dialogue to say you can help with leaving. It always adds a bit of sus */
  <<script>>addSusmeter(1)<</script>>
<</link>>
<<link "Well, that's just how it is, I guess. See you again, then." "Cancel help">>
  /* this cancels the conversation in a neutral way. */
<</link>>
<<link "But of course, our government will always find a way to provide for us. ''Right?''" "Scare off">>
  /* this choice cancels the help suggestion talk and removes some sus, but should also have adverse effects (maybe less people ask for help) */
  <<script>>addSusmeter(1)<</script>>
<</link>>


:: Suggest help 1
"Even if that were true." //They look somewhat disheartened.// "Crossing the border is strictly forbidden."

''Well, yes... And no.''

"How so?"

TODO


:: Cancel help
"Y-Yes, so long.""

[[Back|$last_location]]


:: Scare off
//They left, without even saying anything.//

//Probably scared I'd snitch.//

[[Back|$last_location]]


:: StoryScript [script]
// --------------------
// || --- Config --- ||
// --------------------

// failsafe error message
window.logVariableError = function(variable) {
  console.error("Could not declare "+variable+" in this namespace");
}

// makeshift enum
if (!window.HealthState) {
  window.HealthState = {
    GOOD: 0,
    MILD: 1,
    BAD: 2,
    DEAD: 3
  }
}
else {
  logVariableError("HealthState")
}

// the ratio of an hour to lowest time interval
if (!window.HOUR_DIVIDER) {
  window.HOUR_DIVIDER = 2; // this means that the shortest time interval is hour/2
}
else {
  logVariableError("HOUR_DIVIDER")
}

// ------------------
// || --- Data --- ||
// ------------------

class ItemData {
  constructor(id, space) {
    this.id = id;
    this.space = space;
  }
}

if (!window.Items) {
  window.Items = [
    new ItemData("package", 4),
    new ItemData("cigarettes", 1)
  ];
}
else {
  logVariableError("Items");
}


// -------------------
// || --- Stats --- ||
// -------------------

// money
if (!window._money) {
  window._money = 0.0;
}
else {
  logVariableError("_money")
}
// susmeter
if (!window._susmeter) {
  window._susmeter = 0;
}
else {
  logVariableError("_susmeter")
}
// health
if (!window._health) {
  window._health = HealthState.GOOD;
}
else {
  logVariableError("_health")
}


// --- Time Stuff ---

// day
if (!window._day_counter) {
  window._day_counter = 0;
}
else {
  logVariableError("_day_counter")
}
// time
if (!window._time_steps) {
  window._time_steps = 0;
}
else {
  logVariableError("_time_steps")
}


// -----------------------
// || --- Utilities --- ||
// -----------------------

window.getItem = function(index) {
  return Items[index];
}

window.getMoney = function() {
  return _money;
}

window.addMoney = function(toAdd) {
  _money += toAdd;
}

window.getSusmeter = function() {
  return _susmeter;
}

window.addSusmeter = function(toAdd) {
  _susmeter += toAdd;
}

window.getHealth = function() {
  return _health;
}


// --- Time Stuff ---

window.getDay = function() {
  return _day_counter;
}

// convert time steps to "hh:mm" string
window.getTime = function() {
  let m = (_time_steps % HOUR_DIVIDER) * 60/HOUR_DIVIDER; // each step corresponds to 60min/HOUR_DIVIDER
  let h = Math.floor(_time_steps / HOUR_DIVIDER);
  
  return "" + h + ":" + m;
}

// advance on time step and update day if necessary
window.advanceTimeStep = function(steps = 1) {
  _time_steps += steps;

  let daySteps = 24 * HOUR_DIVIDER // total steps in a day
  let rem = _time_steps % daySteps; // the remaining steps
  

  _day_counter += (_time_steps - rem) / daySteps; // add to days how many full daySteps there are in time steps

  _time_steps = rem; // update time steps
}