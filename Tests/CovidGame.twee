:: StoryTitle
CovidGame


:: StoryData
{
  "ifid": "9CCC0412-E473-4DBA-AECD-4819C661C54A",
  "format": "SugarCube",
  "format-version": "2.36.1",
  "start": "Morning",
  "zoom": 1
}


:: DebugStats
<<set _health to getHealth()>>
<<set _carefulness to getWariness()>>
<<set _social_dist to getSocialDist()>>
<<set _money to getMoney()>>
Health: _health
Carefulness: _carefulness
Social Distance: _social_dist
Money: _money


:: Morning {"position":"475,250","size":"100,100"}
<<include "DebugStats">>
<<set $stable_passage to "Morning">>

Good morning Steve, get ready for another day!

<<if getMask()>>
  [[Remove Mask|RemoveMask]]
<<else>>
  [[Put a mask on|TryMask]]
<</if>>
[[Take a COVID test|TryTest]]
[[Go to work|MorningEventPool]]


:: RemoveMask {"position":"150,100","size":"100,100"}
<<include "DebugStats">>
<<script>>setMask(false)<</script>>
Steve looks sort of troubled by the mask. Maybe taking it off a bit would be good.

[[Back|$stable_passage]]


:: ResultTest {"position":"1050,175","size":"100,100"}
<<include "DebugStats">>
/* determine whether Health is below COVID threshold */
<<if getHealth() < COVID_THRESHOLD>>
  It came back positive....

  It seems Steve wasn't careful enough. Right now, the best thing to do is to be extra careful and wait to get better.
<<else>>
  /* Steve is an idiot, so taking a negative test boosts his confidence */
  <<script>>addWariness(-5)<</script>>
  It's negative. Well that's good news, but remember, it might be a false negative. So there is no reason to be any less careful, right Steve? ...Steve?

  Steve, you look way more relieved than you should be...
<</if>>

[[Back|$stable_passage]]


:: TryMask {"position":"775,325","size":"100,100"}
<<include "DebugStats">>
/* this passage determines whether Steve puts on mask and shows the correct message */
<<if isCareless()>>
  <<set _result to arrayChoice([
    "Steve decides not to put on the mask. He read online that masks may cause you to die by choking in your own breath.",
    "Steve decides not to put on the mask. He heard from a friend that their cousin's wife's neighbour had a horrible reaction to wearing a mask for a full day!"
  ])>> /* add more variations inside the array */

  _result /* Display the resulting message */

  [[What the hell, Steve...|$stable_passage]]
<<else>>
  <<script>>addHealth(2)<</script>>
  <<script>>setMask(true)<</script>>
  Steve puts his mask on. Feeling protected already!

  [[Well done, Steve!|$stable_passage]]
<</if>>


:: TryTest {"position":"475,25","size":"100,100"}
<<include "DebugStats">>
/* this passage will have Steve try to take a test */
<<if getWariness() < CARELESS_THRESHOLD>>
  <<set _result to arrayChoice([
    "Screw tests! ...Is what Steve seems to think, as he puts the test he just opened straight in the trash.",
    "Steve looks at the swab in disgust. Seems there is no way he is sticking that up his nose."
  ])>>

  _result /* Display the resulting message */

  [[What the hell, Steve...|$stable_passage]]
<<else>>
  Steve reluctanly stabs his nostril with the swab and rummages around before he finally stops torturing his nose.

  And now, we wait...

  [[Wait for the result|WaitTest]]
<</if>>


:: WaitTest {"position":"725,50","size":"100,100"}
<<include "DebugStats">>
The suspense is killing Steve. He feels fine, sort of.
So it should most definitely be fine....right?

[[See the results|ResultTest]]


:: MorningEventPool {"position":"725,50","size":"100,100"}
<<include "DebugStats">>
/* this passage will have the random events that Steve might do while going to work */
<<nobr>>
<<set $morning_event to either("MorningWalk", "MorningBus", "TeleworkAnnounce")>>
<</nobr>>
<<include $morning_event>>


:: MorningWalk {"position":"725,50","size":"100,100"}
Steve decided to exercise a little and take a walk to the work. 
<<set _greet to randomChance(60)>> /* Probability of greeting someone */
<<if _greet>>
  He sometimes stop to greeting people tho.
  <<script>>addSocialDist(-2)<</script>>
  [[At least he's exercising, right...?|Work]]
<<else>>
  Steve feels good after doing some exercise!
  <<script>>addHealth(2)<</script>>
  [[Nicely done, Steve!|Work]]
<</if>>


:: MorningBus
Steve got it's usual bus to go to work.
<<if isCareless()>> /* doesn't believe in vaccine */
  He straight up sat on the middle of a music gang playing some cool songs to listen to it.

  [[I mean, it is indeed a cool song.|Work]]
<<elseif isParanoid()>>
  Steve started to shout to anyone that tried to sit down close to him. 
  He looks really afraid and clearly he is not okay.
  <<script>>addSocialDist(6)<</script>>

  [[Steve...?|Work]]
<<else>>
  Steve tried to avoid uneeded talk and went to work.
  <<script>>addSocialDist(3)<</script>>

  [[Let's go to work!|Work]]
<</if>>


:: TeleworkAnnounce
Steve's boss just called him to work at home because of the rain, he doesn't need to worry about travel to work!
Isn't that amazing Steve?
<<if isIsolated()>>
  For some reason, Steve doesn't look so happy about this news... What could be wrong?
<</if>>

[[Work at Home|Telework]]
[[Go work|RainWalk]]


:: Telework
<<include "DebugStats">>
/* If steve feels alone, he can just ignore the telework */
<<if isIsolated() && randomChance(80)>>
  <<set _result to arrayChoice([
    "Steve just picked up his umbrella and went work anyways.",
    "Wait, where are you going Steve?"
  ])>>

  _result

  Steve just picked up his umbrella and went work anyways...

  [[Did he just ignored me?|Work]]

<<else>>
  /* Everything is fine, Steve will telework */
  <<set _result to arrayChoice([
    "Yeah, remote work is awesome!",
    "Working in pijamas is a really good feeling, I know how it feels, Steve."
  ])>>

  _result

  <<script>>addSocialDist(5)<</script>>
<</if>>


:: RainWalk
<<include "DebugStats">>
/* probability of getting sick because of the rain /*
<<if randomChance(80)>> 
  <<script>>addHealth(-5)<</script>>
  Oh no! It looks like Steve got a wash from the rain!
  I hope he is still okay.

<<else>>
  The travel worked perfectly, Steve somehow dodged the rain!
<</if>>

[[Continue to Work|Work]]


:: Work {"position":"725,50","size":"100,100"}
<<include "DebugStats">>
<<script>>addSocialDist(-1)<</script>>
<<set _result to arrayChoice([
  "Steve is a regular person, nobody likes working. Oh god, it is already 12:00?",
  "Damn, that was though! At least is lunch time, you can relax a little bit, Steve."
])>>

_result

[[Eat with friends|EatFriends]]
[[Eat alone|EatAlone]]


:: EatAlone
<<include "DebugStats">>

<<if isIsolated && randomChance(80)>>
  Wait, are you going to eat with them? Steve, you know that you need to isolate yourself a little bit, right?

  [[Fine, you can eat with them this time|EatFriends]]

<<else>>
  <<script>>addSocialDist(5)<</script>>
  <<script>>addWariness(3)<</script>>
  <<set _result to arrayChoice([
    "Yeah, who need to eat with real people, you can eat alone perfectly fine.",
    "Everyone needs time with some friends, enjoy while you can, we should take care from now on."
  ])>>
  _result

  [[Back to Work|Work2]]
<</if>>


:: EatFriends
<<include "DebugStats">>
/* Happens when Steve is eating together with people at the work */
<<script>>addSocialDist(-3)<</script>>
<<script>>addHealth(-1)<</script>>
<<script>>addWariness(-1)<</script>>

<<set _result to arrayChoice([
  "Eating with friends is good, I guess. I hope you are following the hygienic protocols, right, Steve?",
  "Everyone needs time with some friends, enjoy while you can, we should take care from now on."
])>>

_result

/* Total chance of an event happening is 27.75%*/
<<if randomChance(15)>>
  /* Chance of friends spreading missinformation */
  <<script>>addWariness(-4)<</script>>

  <<set _result to arrayChoice([
    "Wait, your colleague just told you that his friend's wife's neighbour took a vaccine that gave him cancer? Please do not believe in that, Steve.",
    "Don't listen to this Joe guy that vaccines will turn you into an aligator, his source is twitter! T-W-I-T-T-E-R"
  ])>>
  _result

  [[Oh no, look at the time, back to work!|Work2]]

<<elseif randomChance(15)>>
/* Chance of they being reckless */
  <<set _result to arrayChoice([
    "Okay, they are not using masks and too much close to each other! Steve, do something!",
    "Steve, your friends are not even using masks..."
  ])>>
  _result

  [[Join them|JoinMaskFriends]]
  [[Stay Away|StayAwayFromFriends]]

<<else>>
  [[Back to Work|Work2]]
<</if>>


:: StayAwayFromFriends
<<include "DebugStats">>
<<if isIsolated && randomChance(80)>>
  No, Steve! You should stay away from them, not taking off your mask!
  [[Proceed|JoinMaskFriends]]
<<else>>
  <<script>>addSocialDist(3)<</script>>
  <<set _result to arrayChoice([
    "Perfect, Steve! Let's enjoy our meal alone.",
    "You love spaghetti, don't you? Eating alone will make you appreciate it even more."
  ])>>
  _result
  [[Finish Eating|Work2]]
<</if>>


:: JoinMaskFriends
<<include "DebugStats">>
<<script>>setMask(false)<</script>>
<<script>>addSocialDist(-5)<</script>>

<<set _result to arrayChoice([
  "There's no way to eat with mask, have it?",
  "I hope you are enjoying this situation, Steve."
])>>
_result

[[Finish Eating|Work2]]


:: Work2
<<include "DebugStats">>
/* Here will have */


:: StoryScript [script]
// --------------------
// || --- Config --- ||
// --------------------

// failsafe error message
window.logVariableError = function(variable) {
  console.error("Could not declare "+variable+" in this namespace");
}

// if wariness is below this value, Steve might not do some of the things you tell him
if (!window.CARELESS_THRESHOLD) window.CARELESS_THRESHOLD = 30;
else logVariableError("CARELESS_THRESHOLD")

// if wariness is above this value, Steve might get too paranoid to interact with people
if (!window.PARANOID_THRESHOLD) window.PARANOID_THRESHOLD = 70;
else logVariableError("PARANOID_THRESHOLD")

// if health is below this limit, Steve has COVID
if (!window.COVID_THRESHOLD) window.COVID_THRESHOLD = 30;
else logVariableError("COVID_THRESHOLD")

// if health is below this limit, Steve has COVID AND is very sick
if (!window.SICK_THRESHOLD) window.SICK_THRESHOLD = 10;
else logVariableError("SICK_THRESHOLD")

// if social dist is above this value, Steve starts to feeling alone
if (!window.ISOLATED_THRESHOLD) window.ISOLATED_THRESHOLD = 70;
else logVariableError("ISOLATED_THRESHOLD")

// -------------------
// || --- Stats --- ||
// -------------------

// wariness (or carefulness)
if (!window._wariness) window._wariness = 71;
else logVariableError("_wariness")
window.getWariness = function() {
  return _wariness;
}
window.addWariness = function(toAdd) {
  _wariness += toAdd;
}
window.isCareless = function() {
  return _wariness < CARELESS_THRESHOLD
}
window.isParanoid = function() {
  return _wariness > PARANOID_THRESHOLD
}

// social_dist
if (!window._social_dist) window._social_dist = 71;
else logVariableError("_social_dist")
window.getSocialDist = function() {
  return _social_dist;
}
window.addSocialDist = function(toAdd) {
  _social_dist += toAdd;
}
window.isIsolated = function() {
  return _social_dist > ISOLATED_THRESHOLD
}

// health
if (!window._health) window._health = 50;
else logVariableError("_health")
window.getHealth = function() {
  return _health;
}
window.addHealth = function(toAdd) {
  _health += toAdd;
}

// money
if (!window._money) window._money = 50;
else logVariableError("_money")
window.getMoney = function() {
  return _money;
}
window.addMoney = function(toAdd) {
  _money += toAdd;
}

// --- Non-Numeric ---

// whether Steve has mask on, could be interesting
if (!window._has_mask) window._has_mask = false;
else logVariableError("_has_mask")
window.getMask = function() {
  return _has_mask;
}
window.setMask = function(onoff) {
  _has_mask = onoff;
}


// -------------------
// || --- Utils --- ||
// -------------------

// return a random int between min (inclusive) and max (inclusive)
window.randint = function(min, max) {
  return Math.floor(Math.random() * (max - min + 1) + min)
}

// return a random element from an array
window.arrayChoice = function(array) {
  let ix = randint(0, array.length - 1); // choose random index
  return array[ix];
}

// return boolean for random probability chance (in %)
window.randomChance = function(probability) {
  return Math.random() < probability/100
}